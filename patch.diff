From f49c2a35dda723175d78d4b8f8b57c70af8ec639 Mon Sep 17 00:00:00 2001
From: Codex <codex@openai.com>
Date: Sun, 8 Feb 2026 09:34:11 +0000
Subject: [PATCH] Refactor UI to Google AI Studio style with Russian
 localization and quota tracking
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

### Motivation
- Restyle the app to a clean, threepane Google AI Studioinspired layout and provide Russian UI labels for a polished localized UX.
- Improve reliability and user awareness by parsing 429 quota errors, tracking permodel quotas locally, and adding autofallback/autoretry behavior.
- Fix critical UX bugs: preserve partial assistant responses when stopping a stream and add permessage action buttons (retry/copy/delete) for model messages.

### Description
- UI: Reworked main layout into left chat list / center messages / right models/settings panes, added avatars, improved spacing and typography, and loaded Inter/Googlelike font; files: `src/App.tsx`, `index.html`, `src/index.css`.
- Localization: Converted many UI strings and export text to Russian, updated chat defaults and export headings; file: `src/lib/db.ts` and `src/App.tsx`.
- Quota system: Added `parseQuotaError`, a `QuotaStore` persisted to `localStorage`, quota badge rendering, auto reset at UTC midnight, warnings at 80% usage, and autofallback to alternative models when quotas fail; implemented helpers and state in `src/App.tsx` and new constants `QUOTA_STORAGE_KEY`.
- Messaging/UX fixes: Replaced custom markdown sanitizer with `react-markdown` + `rehype-highlight` usage for code highlighting, preserved partial streamed assistant text when `Stop` is pressed, added permodel message actions (`Повторить`, `Копировать`, `Удалить`) and retry logic that deletes later messages and resends; updated DB to support deleting single messages; files: `src/App.tsx`, `src/lib/db.ts`, `package.json` (deps added).

### Testing
- Attempted to install runtime markdown deps with `npm install react-markdown rehype-highlight`, which failed with a 403 from the registry so the packages could not be installed in this environment (failed).
- Started the dev server with `npm run dev:client` (Vite started), but Vite reported unresolved imports for `react-markdown`/`rehype-highlight` because installation was blocked, causing pretransform errors (observed failure to fully run the app).
- Ran a Playwright screenshot script that connected to the local Vite server and produced an artifact, but the app did not fully render due to the missing markdown dependencies (screenshot saved but UI incomplete).
- No unit tests were added; manual runtime checks were attempted and failed due to the blocked dependency install, so runtime verification is incomplete.
---
 index.html    |   8 +-
 package.json  |   4 +-
 src/App.tsx   | 788 +++++++++++++++++++++++++++++++++-----------------
 src/index.css |   4 +
 src/lib/db.ts |  10 +-
 5 files changed, 545 insertions(+), 269 deletions(-)

diff --git a/index.html b/index.html
index 2cb5bb3..2e1a410 100644
--- a/index.html
+++ b/index.html
@@ -1,8 +1,14 @@
 <!DOCTYPE html>
-<html lang="en">
+<html lang="ru">
   <head>
     <meta charset="UTF-8" />
     <link rel="icon" type="image/svg+xml" href="/vite.svg" />
+    <link rel="preconnect" href="https://fonts.googleapis.com" />
+    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
+    <link
+      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
+      rel="stylesheet"
+    />
     <meta name="viewport" content="width=device-width, initial-scale=1.0" />
     <title>Pollux Chat</title>
   </head>
diff --git a/package.json b/package.json
index 768a470..15cb1b3 100644
--- a/package.json
+++ b/package.json
@@ -17,7 +17,9 @@
     "highlight.js": "^11.11.1",
     "lucide-react": "^0.563.0",
     "react": "19.2.3",
-    "react-dom": "19.2.3"
+    "react-dom": "19.2.3",
+    "react-markdown": "^10.1.0",
+    "rehype-highlight": "^7.0.2"
   },
   "devDependencies": {
     "@tailwindcss/vite": "4.1.17",
diff --git a/src/App.tsx b/src/App.tsx
index 7de1436..e8deaba 100644
--- a/src/App.tsx
+++ b/src/App.tsx
@@ -1,21 +1,85 @@
-import { useState, useEffect, useRef } from 'react';
+import { useState, useEffect, useRef, useMemo } from 'react';
 import { 
   Send, Square, RotateCcw, Pencil, Download, Trash2, Plus, 
   Settings, Moon, Sun, Image, X, Check, MessageSquare,
-  ChevronDown, RefreshCw, Menu, AlertCircle, Copy, ExternalLink
+  RefreshCw, Menu, AlertCircle, Copy, ExternalLink,
+  Bot, User, ArrowRightLeft
 } from 'lucide-react';
-import hljs from 'highlight.js';
 import 'highlight.js/styles/github-dark.css';
+import ReactMarkdown from 'react-markdown';
+import rehypeHighlight from 'rehype-highlight';
 import { useTheme } from './hooks/useTheme';
 import { encryptApiKey, decryptApiKey, clearApiKey, hasStoredKey } from './lib/crypto';
 import { 
   createChat, getAllChats, getChat, updateChat, deleteChat,
   addMessage, getChatMessages, deleteMessagesAfter, exportChat,
-  type Chat, type ChatMessage 
+  type Chat, type ChatMessage, deleteMessage 
 } from './lib/db';
 
 const API_BASE = import.meta.env.DEV ? 'http://localhost:3001' : '';
 
+function getNextUtcMidnight(): number {
+  const now = new Date();
+  return Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate() + 1, 0, 0, 0);
+}
+
+function loadQuotaStore(): QuotaStore {
+  try {
+    const raw = localStorage.getItem(QUOTA_STORAGE_KEY);
+    if (!raw) return { modelQuotas: {} };
+    const parsed = JSON.parse(raw) as QuotaStore;
+    if (!parsed?.modelQuotas) return { modelQuotas: {} };
+    const normalized: Record<string, QuotaInfo> = {};
+    Object.entries(parsed.modelQuotas).forEach(([key, value]) => {
+      normalized[key] = normalizeQuota(value);
+    });
+    return { modelQuotas: normalized };
+  } catch {
+    return { modelQuotas: {} };
+  }
+}
+
+function saveQuotaStore(store: QuotaStore) {
+  localStorage.setItem(QUOTA_STORAGE_KEY, JSON.stringify(store));
+}
+
+function normalizeQuota(quota: QuotaInfo): QuotaInfo {
+  if (!quota.resetAt) return quota;
+  if (Date.now() >= quota.resetAt) {
+    return {
+      ...quota,
+      used: 0,
+      remaining: quota.limit ?? null,
+      resetAt: quota.limit === null ? null : getNextUtcMidnight(),
+      lastUpdated: Date.now()
+    };
+  }
+  return quota;
+}
+
+function parseQuotaError(errorText: string) {
+  const match = errorText.match(/limit: (\d+)/);
+  const limitMatch = match ? parseInt(match[1], 10) : null;
+
+  const quotaValueMatch = errorText.match(/"quotaValue":"(\d+)"/);
+  const used = quotaValueMatch ? parseInt(quotaValueMatch[1], 10) : null;
+
+  const retryMatch = errorText.match(/retryDelay["\s:]+(\d+)s/);
+  const retrySeconds = retryMatch ? parseInt(retryMatch[1], 10) : null;
+
+  const isPerDay = errorText.includes('PerDay');
+  const isPerMinute = errorText.includes('PerMinute');
+
+  return {
+    limit: limitMatch,
+    used,
+    remaining: limitMatch !== null && used !== null ? limitMatch - used : null,
+    retryAfter: retrySeconds ? Date.now() + retrySeconds * 1000 : null,
+    period: isPerDay ? 'day' : isPerMinute ? 'minute' : 'unknown',
+    available: limitMatch !== 0
+  };
+}
+
 interface Model {
   value: string;
   label: string;
@@ -24,10 +88,19 @@ interface Model {
   outputTokens?: number;
 }
 
-const FALLBACK_MODELS: Model[] = [
-  { value: 'gemini-2.0-flash', label: 'Gemini 2.0 Flash', description: 'Fast and efficient' },
-  { value: 'gemini-1.5-pro', label: 'Gemini 1.5 Pro', description: 'Most capable' },
-];
+interface QuotaInfo {
+  limit: number | null;
+  used: number | null;
+  remaining: number | null;
+  resetAt: number | null;
+  lastUpdated: number;
+}
+
+interface QuotaStore {
+  modelQuotas: Record<string, QuotaInfo>;
+}
+
+const QUOTA_STORAGE_KEY = 'pollux-quotas';
 
 export default function App() {
   const { theme, toggleTheme } = useTheme();
@@ -51,10 +124,17 @@ export default function App() {
   const [editingContent, setEditingContent] = useState('');
   
   // Model state
-  const [models, setModels] = useState<Model[]>(FALLBACK_MODELS);
-  const [selectedModel, setSelectedModel] = useState('gemini-2.0-flash');
-  const [showModelDropdown, setShowModelDropdown] = useState(false);
+  const [models, setModels] = useState<Model[]>([]);
+  const [selectedModel, setSelectedModel] = useState('');
   const [loadingModels, setLoadingModels] = useState(false);
+  const [quotaStore, setQuotaStore] = useState<QuotaStore>(() => loadQuotaStore());
+  const [errorBanner, setErrorBanner] = useState('');
+  const [retryAt, setRetryAt] = useState<number | null>(null);
+  const [autoRetryMessage, setAutoRetryMessage] = useState<{
+    text: string;
+    images: string[];
+    model: string;
+  } | null>(null);
   
   // System prompt
   const [systemPrompt, setSystemPrompt] = useState('');
@@ -74,6 +154,40 @@ export default function App() {
     initializeApp();
   }, []);
 
+  useEffect(() => {
+    saveQuotaStore(quotaStore);
+  }, [quotaStore]);
+
+  useEffect(() => {
+    const nextReset = getNextUtcMidnight();
+    const timeout = window.setTimeout(() => {
+      setQuotaStore(prev => {
+        const updated: Record<string, QuotaInfo> = {};
+        Object.entries(prev.modelQuotas).forEach(([key, value]) => {
+          updated[key] = normalizeQuota({ ...value, resetAt: nextReset });
+        });
+        return { modelQuotas: updated };
+      });
+    }, Math.max(0, nextReset - Date.now()));
+    return () => window.clearTimeout(timeout);
+  }, []);
+
+  useEffect(() => {
+    if (!retryAt || !autoRetryMessage) return;
+    const timer = window.setInterval(() => {
+      if (Date.now() >= retryAt) {
+        clearInterval(timer);
+        const payload = autoRetryMessage;
+        setRetryAt(null);
+        setAutoRetryMessage(null);
+        sendMessage(payload.text, payload.images, payload.model);
+      } else {
+        setErrorBanner(` Повторите через ${Math.max(1, Math.ceil((retryAt - Date.now()) / 1000))} секунд`);
+      }
+    }, 500);
+    return () => clearInterval(timer);
+  }, [retryAt, autoRetryMessage]);
+
   async function initializeApp() {
     if (hasStoredKey()) {
       const key = await decryptApiKey();
@@ -85,6 +199,56 @@ export default function App() {
     }
   }
 
+  function updateQuota(modelValue: string, update: Partial<QuotaInfo>) {
+    setQuotaStore(prev => {
+      const existing = prev.modelQuotas[modelValue];
+      const next: QuotaInfo = normalizeQuota({
+        limit: update.limit ?? existing?.limit ?? null,
+        used: update.used ?? existing?.used ?? null,
+        remaining: update.remaining ?? existing?.remaining ?? null,
+        resetAt: update.resetAt ?? existing?.resetAt ?? null,
+        lastUpdated: Date.now()
+      });
+      return {
+        ...prev,
+        modelQuotas: {
+          ...prev.modelQuotas,
+          [modelValue]: next
+        }
+      };
+    });
+  }
+
+  function getQuota(modelValue: string): QuotaInfo | undefined {
+    const quota = quotaStore.modelQuotas[modelValue];
+    return quota ? normalizeQuota(quota) : undefined;
+  }
+
+  function selectFallbackModel(current: string) {
+    const fallback = models.find(model => {
+      if (model.value === current) return false;
+      const quota = getQuota(model.value);
+      if (quota?.limit === 0) return false;
+      if (quota?.remaining !== null && quota.remaining <= 0) return false;
+      return true;
+    });
+    if (fallback) {
+      setSelectedModel(fallback.value);
+      setErrorBanner(`Переключено на ${fallback.label} (осталось ${getQuota(fallback.value)?.remaining ?? ''} запросов)`);
+    }
+  }
+
+  const quotaWarningMessage = useMemo(() => {
+    if (!selectedModel) return '';
+    const quota = getQuota(selectedModel);
+    if (!quota || quota.limit === null || quota.limit === 0 || quota.used === null) return '';
+    const usedRatio = quota.limit > 0 ? quota.used / quota.limit : 0;
+    if (usedRatio >= 0.8 && quota.remaining !== null && quota.remaining > 0) {
+      return ` Осталось ${quota.remaining} запрос(ов) на сегодня`;
+    }
+    return '';
+  }, [quotaStore, selectedModel]);
+
   async function loadChats() {
     const allChats = await getAllChats();
     setChats(allChats);
@@ -140,7 +304,7 @@ export default function App() {
       const data = await res.json();
       if (data.models?.length) {
         setModels(data.models);
-        if (data.models[0]) {
+        if (!selectedModel && data.models[0]) {
           setSelectedModel(data.models[0].value);
         }
       }
@@ -172,7 +336,9 @@ export default function App() {
         // Models come back with the test-key response
         if (data.models?.length) {
           setModels(data.models);
-          setSelectedModel(data.models[0].value);
+          if (data.models[0]) {
+            setSelectedModel(data.models[0].value);
+          }
         } else {
           loadModels(keyInput);
         }
@@ -194,6 +360,8 @@ export default function App() {
     setMessages([]);
     setCurrentChatId(null);
     setShowSettings(false);
+    setModels([]);
+    setSelectedModel('');
   }
 
   // Scroll to bottom
@@ -209,12 +377,11 @@ export default function App() {
     }
   }, [input]);
 
-  // Highlight code blocks
   useEffect(() => {
-    document.querySelectorAll('pre code').forEach((block) => {
-      hljs.highlightElement(block as HTMLElement);
-    });
-  }, [messages, streamingText]);
+    if (!selectedModel && models.length > 0) {
+      setSelectedModel(models[0].value);
+    }
+  }, [models, selectedModel]);
 
   // File handling
   function handleFiles(files: FileList | File[]) {
@@ -266,42 +433,42 @@ export default function App() {
   }
 
   // Send message
-  async function handleSend() {
-    if ((!input.trim() && images.length === 0) || isLoading || !apiKey) return;
-    
+  async function sendMessage(text: string, attachedImages: string[], modelOverride?: string) {
+    if ((!text.trim() && attachedImages.length === 0) || isLoading || !apiKey) return;
+    if (!modelOverride && !selectedModel) return;
+
     let chatId = currentChatId;
-    
-    // Create new chat if none exists
+
     if (!chatId) {
       const chat = await createChat(systemPrompt || undefined);
       setChats(prev => [chat, ...prev]);
       chatId = chat.id;
       setCurrentChatId(chatId);
     }
-    
-    // Save user message
+
     const userMessage = await addMessage({
       chatId,
       role: 'user',
-      content: input.trim(),
-      images: images.length > 0 ? [...images] : undefined
+      content: text.trim(),
+      images: attachedImages.length > 0 ? [...attachedImages] : undefined
     });
-    
+
     setMessages(prev => [...prev, userMessage]);
     setInput('');
     setImages([]);
     setIsLoading(true);
     setStreamingText('');
-    
-    // Refresh chat list (title may have updated)
+    setErrorBanner('');
+
     loadChats();
-    
-    // Setup abort controller
+
     abortControllerRef.current = new AbortController();
-    
+
     try {
       const chat = await getChat(chatId);
-      
+      const historyMessages = await getChatMessages(chatId);
+      const modelToUse = modelOverride || selectedModel;
+
       const res = await fetch(`${API_BASE}/api/chat`, {
         method: 'POST',
         headers: {
@@ -309,42 +476,64 @@ export default function App() {
           Authorization: `Bearer ${apiKey}`
         },
         body: JSON.stringify({
-          model: selectedModel,
-          messages: messages.map(m => ({
+          model: modelToUse,
+          messages: historyMessages.map(m => ({
             role: m.role,
             content: m.content,
             images: m.images
           })),
           newMessage: {
-            text: input.trim(),
-            images
+            text: text.trim(),
+            images: attachedImages
           },
           systemPrompt: chat?.systemPrompt || systemPrompt
         }),
         signal: abortControllerRef.current.signal
       });
-      
+
       if (!res.ok) {
-        throw new Error(await res.text());
+        const errorText = await res.text();
+        if (res.status === 429) {
+          const quotaInfo = parseQuotaError(errorText);
+          updateQuota(modelToUse, {
+            limit: quotaInfo.limit,
+            used: quotaInfo.used,
+            remaining: quotaInfo.remaining,
+            resetAt: quotaInfo.period === 'day' ? getNextUtcMidnight() : null
+          });
+
+          if (quotaInfo.limit === 0) {
+            setErrorBanner(` Модель ${modelToUse} недоступна на бесплатном тарифе`);
+            selectFallbackModel(modelToUse);
+          } else if (quotaInfo.remaining === 0) {
+            setErrorBanner(` Лимит исчерпан (0/${quotaInfo.limit ?? ''}). Обновится завтра в 00:00 UTC.`);
+            selectFallbackModel(modelToUse);
+          } else if (quotaInfo.retryAfter) {
+            setRetryAt(quotaInfo.retryAfter);
+            setAutoRetryMessage({ text: text.trim(), images: attachedImages, model: modelToUse });
+            setErrorBanner(` Повторите через ${Math.max(1, Math.ceil((quotaInfo.retryAfter - Date.now()) / 1000))} секунд`);
+          }
+          throw new Error('quota_error');
+        }
+        throw new Error(errorText);
       }
-      
-      // Read stream
+
       const reader = res.body?.getReader();
       const decoder = new TextDecoder();
       let fullText = '';
-      
+
       while (reader) {
         const { done, value } = await reader.read();
         if (done) break;
-        
+
         const chunk = decoder.decode(value);
         const lines = chunk.split('\n');
-        
+
         for (const line of lines) {
           if (line.startsWith('data: ')) {
             const data = line.slice(6);
             if (data === '[DONE]') break;
-            
+
             try {
               const parsed = JSON.parse(data);
               if (parsed.error) {
@@ -354,14 +543,13 @@ export default function App() {
                 fullText += parsed.text;
                 setStreamingText(fullText);
               }
-            } catch (e) {
+            } catch {
               // Ignore parse errors
             }
           }
         }
       }
-      
-      // Save assistant message
+
       if (fullText) {
         const assistantMessage = await addMessage({
           chatId,
@@ -370,13 +558,12 @@ export default function App() {
         });
         setMessages(prev => [...prev, assistantMessage]);
       }
-      
     } catch (error: any) {
-      if (error.name !== 'AbortError') {
+      if (error.name !== 'AbortError' && error.message !== 'quota_error') {
         const errorMessage = await addMessage({
           chatId,
           role: 'model',
-          content: `Error: ${error.message}`
+          content: `Ошибка: ${error.message}`
         });
         setMessages(prev => [...prev, errorMessage]);
       }
@@ -387,9 +574,22 @@ export default function App() {
     }
   }
 
+  async function handleSend() {
+    await sendMessage(input.trim(), images);
+  }
+
   function handleStop() {
     abortControllerRef.current?.abort();
     setIsLoading(false);
+    if (streamingText.trim() && currentChatId) {
+      addMessage({
+        chatId: currentChatId,
+        role: 'model',
+        content: streamingText
+      }).then(message => {
+        setMessages(prev => [...prev, message]);
+      });
+    }
     setStreamingText('');
   }
 
@@ -409,9 +609,7 @@ export default function App() {
     const updatedMessages = await getChatMessages(currentChatId!);
     setMessages(updatedMessages);
     
-    // Resend
-    setInput(lastUserMessage.content);
-    setImages(lastUserMessage.images || []);
+    await sendMessage(lastUserMessage.content, lastUserMessage.images || []);
   }
 
   function startEdit(message: ChatMessage) {
@@ -434,6 +632,30 @@ export default function App() {
     setEditingContent('');
   }
 
+  async function handleRetryMessage(messageId: string) {
+    if (!currentChatId) return;
+    const currentMessages = await getChatMessages(currentChatId);
+    const targetIndex = currentMessages.findIndex(m => m.id === messageId);
+    if (targetIndex <= 0) return;
+    const previousUser = [...currentMessages]
+      .slice(0, targetIndex)
+      .reverse()
+      .find(m => m.role === 'user');
+    if (!previousUser) return;
+
+    await deleteMessagesAfter(currentChatId, previousUser.id);
+    const refreshed = await getChatMessages(currentChatId);
+    setMessages(refreshed);
+    await sendMessage(previousUser.content, previousUser.images || []);
+  }
+
+  async function handleDeleteMessage(messageId: string) {
+    if (!currentChatId) return;
+    await deleteMessage(messageId);
+    const refreshed = await getChatMessages(currentChatId);
+    setMessages(refreshed);
+  }
+
   async function handleExport() {
     if (!currentChatId) return;
     
@@ -458,45 +680,40 @@ export default function App() {
     navigator.clipboard.writeText(text);
   }
 
-  // Render markdown with code highlighting
-  function renderMarkdown(text: string) {
-    let html = text
-      // Code blocks
-      .replace(/```(\w+)?\n([\s\S]*?)```/g, (_, lang, code) => {
-        const language = lang || 'plaintext';
-        return `<pre><code class="language-${language}">${escapeHtml(code.trim())}</code></pre>`;
-      })
-      // Inline code
-      .replace(/`([^`]+)`/g, '<code class="inline-code">$1</code>')
-      // Bold
-      .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
-      // Italic
-      .replace(/\*(.+?)\*/g, '<em>$1</em>')
-      // Links
-      .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener" class="text-blue-400 hover:underline">$1</a>')
-      // Line breaks
-      .replace(/\n/g, '<br>');
-    
-    return html;
-  }
-
-  function escapeHtml(text: string) {
-    return text
-      .replace(/&/g, '&amp;')
-      .replace(/</g, '&lt;')
-      .replace(/>/g, '&gt;');
+  function getQuotaBadge(model: Model) {
+    const quota = getQuota(model.value);
+    if (!quota) {
+      return { text: 'Нет данных', color: 'bg-zinc-200 text-zinc-600' };
+    }
+    if (quota.limit === 0) {
+      return { text: 'Недоступна (Free tier)', color: 'bg-zinc-300 text-zinc-600' };
+    }
+    if (quota.limit !== null && quota.remaining !== null) {
+      const ratio = quota.limit > 0 ? quota.remaining / quota.limit : 0;
+      if (quota.remaining === 0) {
+        return { text: `0/${quota.limit} исчерпан`, color: 'bg-red-100 text-red-700' };
+      }
+      if (ratio <= 0.1) {
+        return { text: `${quota.remaining}/${quota.limit} осталось`, color: 'bg-red-100 text-red-700' };
+      }
+      if (ratio <= 0.5) {
+        return { text: `${quota.remaining}/${quota.limit} осталось`, color: 'bg-yellow-100 text-yellow-700' };
+      }
+      return { text: `${quota.remaining}/${quota.limit} осталось`, color: 'bg-green-100 text-green-700' };
+    }
+    return { text: 'Нет данных', color: 'bg-zinc-200 text-zinc-600' };
   }
 
   // API Key modal
   if (!apiKey) {
     return (
-      <div className="min-h-screen bg-zinc-900 flex items-center justify-center p-4">
-        <div className="bg-zinc-800 rounded-2xl p-8 max-w-md w-full shadow-2xl">
+      <div className="min-h-screen bg-zinc-50 flex items-center justify-center p-4">
+        <div className="bg-white rounded-3xl p-8 max-w-md w-full shadow-xl border border-zinc-200">
           <div className="text-center mb-8">
-            <h1 className="text-3xl font-bold text-white mb-2">Pollux Chat</h1>
-            <p className="text-zinc-400">Enter your Google AI API key to start</p>
+            <h1 className="text-3xl font-bold text-zinc-900 mb-2">Pollux Chat</h1>
+            <p className="text-zinc-500">Введите ключ Google AI, чтобы начать</p>
           </div>
-          
+
           <div className="space-y-4">
             <div>
               <input
@@ -505,40 +722,40 @@ export default function App() {
                 onChange={(e) => setKeyInput(e.target.value)}
                 onKeyDown={(e) => e.key === 'Enter' && handleSubmitKey()}
                 placeholder="AIza..."
-                className="w-full bg-zinc-700 text-white rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500"
+                className="w-full bg-zinc-100 text-zinc-900 rounded-lg px-4 py-3 outline-none focus:ring-2 focus:ring-blue-500 border border-zinc-200"
               />
             </div>
-            
+
             {keyError && (
-              <div className="flex items-center gap-2 text-red-400 text-sm">
+              <div className="flex items-center gap-2 text-red-500 text-sm">
                 <AlertCircle size={16} />
                 {keyError}
               </div>
             )}
-            
+
             <button
               onClick={handleSubmitKey}
               disabled={checkingKey || !keyInput.trim()}
               className="w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white font-medium rounded-lg py-3 transition"
             >
-              {checkingKey ? 'Checking...' : 'Start Chatting'}
+              {checkingKey ? 'Проверяем...' : 'Начать чат'}
             </button>
-            
+
             <a
               href="https://aistudio.google.com/app/apikey"
               target="_blank"
               rel="noopener"
-              className="flex items-center justify-center gap-2 text-blue-400 hover:text-blue-300 text-sm"
+              className="flex items-center justify-center gap-2 text-blue-500 hover:text-blue-600 text-sm"
             >
               <ExternalLink size={14} />
-              Get free API key from Google AI Studio
+              Получить бесплатный ключ в Google AI Studio
             </a>
           </div>
-          
-          <div className="mt-8 p-4 bg-zinc-700/50 rounded-lg">
-            <p className="text-zinc-400 text-xs text-center">
-               Your API key is encrypted and stored only in this browser.
-              Chats are saved locally and will be lost if you clear browser data.
+
+          <div className="mt-8 p-4 bg-zinc-50 rounded-lg border border-zinc-200">
+            <p className="text-zinc-500 text-xs text-center">
+               Ключ шифруется и хранится только в этом браузере.
+              Чаты сохраняются локально и будут удалены при очистке данных.
             </p>
           </div>
         </div>
@@ -550,43 +767,41 @@ export default function App() {
 
   return (
     <div 
-      className={`h-screen flex ${theme === 'dark' ? 'bg-zinc-900 text-white' : 'bg-white text-zinc-900'}`}
+      className={`h-screen w-full flex ${theme === 'dark' ? 'bg-zinc-900 text-zinc-100' : 'bg-zinc-50 text-zinc-900'}`}
       onDragEnter={handleDragEnter}
       onDragOver={(e) => e.preventDefault()}
       onDragLeave={handleDragLeave}
       onDrop={handleDrop}
     >
-      {/* Drag overlay */}
       {dragOver && (
         <div className="fixed inset-0 bg-blue-500/20 backdrop-blur-sm z-50 flex items-center justify-center">
-          <div className="bg-zinc-800 rounded-2xl p-8 text-center">
-            <Image size={48} className="mx-auto mb-4 text-blue-400" />
-            <p className="text-white text-lg">Drop images here</p>
+          <div className="bg-white rounded-2xl p-8 text-center shadow-xl">
+            <Image size={48} className="mx-auto mb-4 text-blue-500" />
+            <p className="text-zinc-900 text-lg">Перетащите изображения сюда</p>
           </div>
         </div>
       )}
 
-      {/* Sidebar */}
-      <aside className={`${sidebarOpen ? 'w-64' : 'w-0'} transition-all duration-300 overflow-hidden flex-shrink-0 ${theme === 'dark' ? 'bg-zinc-800' : 'bg-zinc-100'} flex flex-col`}>
-        <div className="p-3">
+      <aside className={`${sidebarOpen ? 'w-72' : 'w-0'} transition-all duration-300 overflow-hidden flex-shrink-0 ${theme === 'dark' ? 'bg-zinc-900 border-zinc-800' : 'bg-zinc-50 border-zinc-200'} border-r flex flex-col`}>
+        <div className="p-4">
           <button
             onClick={handleNewChat}
-            className={`w-full flex items-center gap-2 px-4 py-2 rounded-lg ${theme === 'dark' ? 'bg-zinc-700 hover:bg-zinc-600' : 'bg-white hover:bg-zinc-200'} transition`}
+            className={`w-full flex items-center justify-center gap-2 px-4 py-2 rounded-full ${theme === 'dark' ? 'bg-zinc-800 hover:bg-zinc-700' : 'bg-white hover:bg-zinc-100'} border ${theme === 'dark' ? 'border-zinc-700' : 'border-zinc-200'} transition`}
           >
             <Plus size={18} />
-            New Chat
+            Новый чат
           </button>
         </div>
-        
-        <div className="flex-1 overflow-y-auto px-2">
+
+        <div className="flex-1 overflow-y-auto px-3 pb-3">
           {chats.map(chat => (
             <div
               key={chat.id}
               onClick={() => selectChat(chat.id)}
-              className={`group flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer mb-1 ${
+              className={`group flex items-center gap-2 px-3 py-2 rounded-xl cursor-pointer mb-1 ${
                 currentChatId === chat.id
-                  ? theme === 'dark' ? 'bg-zinc-700' : 'bg-zinc-200'
-                  : theme === 'dark' ? 'hover:bg-zinc-700/50' : 'hover:bg-zinc-200/50'
+                  ? theme === 'dark' ? 'bg-zinc-800' : 'bg-white shadow-sm'
+                  : theme === 'dark' ? 'hover:bg-zinc-800/60' : 'hover:bg-white'
               }`}
             >
               <MessageSquare size={16} className="flex-shrink-0 opacity-50" />
@@ -594,205 +809,189 @@ export default function App() {
               <button
                 onClick={(e) => { e.stopPropagation(); handleDeleteChat(chat.id); }}
                 className="opacity-0 group-hover:opacity-100 p-1 hover:text-red-400 transition"
+                title="Удалить чат"
               >
                 <Trash2 size={14} />
               </button>
             </div>
           ))}
         </div>
-        
-        <div className={`p-3 border-t ${theme === 'dark' ? 'border-zinc-700' : 'border-zinc-200'}`}>
+
+        <div className={`p-3 border-t ${theme === 'dark' ? 'border-zinc-800' : 'border-zinc-200'}`}>
           <p className="text-xs text-zinc-500 text-center">
-            Chats stored locally
+            История хранится локально
           </p>
         </div>
       </aside>
 
-      {/* Main */}
       <main className="flex-1 flex flex-col min-w-0">
-        {/* Header */}
-        <header className={`flex items-center gap-3 px-4 py-2 border-b ${theme === 'dark' ? 'border-zinc-700' : 'border-zinc-200'}`}>
-          <button onClick={() => setSidebarOpen(!sidebarOpen)} className="p-2 hover:bg-zinc-700/50 rounded-lg">
+        <header className={`flex items-center gap-3 px-6 py-4 border-b ${theme === 'dark' ? 'border-zinc-800' : 'border-zinc-200'}`}>
+          <button onClick={() => setSidebarOpen(!sidebarOpen)} className={`p-2 rounded-full ${theme === 'dark' ? 'hover:bg-zinc-800' : 'hover:bg-zinc-200/60'}`}>
             <Menu size={20} />
           </button>
-          
-          <h1 className="font-semibold">Pollux Chat</h1>
-          
-          <div className="flex-1" />
-          
-          {/* Model selector */}
-          <div className="relative">
-            <button
-              onClick={() => setShowModelDropdown(!showModelDropdown)}
-              className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm ${theme === 'dark' ? 'bg-zinc-700 hover:bg-zinc-600' : 'bg-zinc-100 hover:bg-zinc-200'}`}
-            >
-              {loadingModels ? 'Loading...' : currentModel?.label || 'Select model'}
-              <ChevronDown size={16} />
-            </button>
-            
-            {showModelDropdown && (
-              <div className={`absolute right-0 top-full mt-1 w-80 rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto ${theme === 'dark' ? 'bg-zinc-800 border border-zinc-700' : 'bg-white border border-zinc-200'}`}>
-                <div className="p-2 border-b border-zinc-700 flex items-center justify-between">
-                  <span className="text-sm text-zinc-400">Models</span>
-                  <button onClick={() => loadModels(apiKey)} className="p-1 hover:bg-zinc-700 rounded">
-                    <RefreshCw size={14} className={loadingModels ? 'animate-spin' : ''} />
-                  </button>
-                </div>
-                {models.map(model => (
-                  <button
-                    key={model.value}
-                    onClick={() => { setSelectedModel(model.value); setShowModelDropdown(false); }}
-                    className={`w-full text-left px-3 py-2 hover:bg-zinc-700/50 ${selectedModel === model.value ? 'bg-zinc-700' : ''}`}
-                  >
-                    <div className="font-medium text-sm">{model.label}</div>
-                    <div className="text-xs text-zinc-400 truncate">{model.description}</div>
-                    {model.inputTokens && (
-                      <div className="text-xs text-zinc-500 mt-1">
-                        {(model.inputTokens / 1000).toFixed(0)}K / {(model.outputTokens! / 1000).toFixed(0)}K tokens
-                      </div>
-                    )}
-                  </button>
-                ))}
-              </div>
-            )}
+          <div>
+            <h1 className="font-semibold text-lg">Pollux Chat</h1>
+            <p className="text-xs text-zinc-500">Интерфейс в стиле Google AI Studio</p>
           </div>
-          
-          <button onClick={() => setShowSystemPrompt(true)} className="p-2 hover:bg-zinc-700/50 rounded-lg" title="System Prompt">
-            <Settings size={18} />
-          </button>
-          
-          <button onClick={handleExport} className="p-2 hover:bg-zinc-700/50 rounded-lg" title="Export Chat">
-            <Download size={18} />
-          </button>
-          
-          <button onClick={toggleTheme} className="p-2 hover:bg-zinc-700/50 rounded-lg">
-            {theme === 'dark' ? <Sun size={18} /> : <Moon size={18} />}
-          </button>
-          
-          <button onClick={() => setShowSettings(true)} className="p-2 hover:bg-zinc-700/50 rounded-lg text-red-400" title="Settings">
-            <X size={18} />
-          </button>
+          <div className="flex-1" />
+          {currentModel && (
+            <div className="hidden md:flex items-center gap-2 text-xs text-zinc-500">
+              <span>Модель:</span>
+              <span className={theme === 'dark' ? 'text-zinc-200' : 'text-zinc-700'}>{currentModel.label}</span>
+            </div>
+          )}
         </header>
 
-        {/* Messages */}
-        <div className="flex-1 overflow-y-auto p-4">
+        {errorBanner && (
+          <div className="px-6 pt-4">
+            <div className="rounded-xl border border-yellow-200 bg-yellow-50 px-4 py-3 text-sm text-yellow-800">
+              {errorBanner}
+            </div>
+          </div>
+        )}
+
+        {quotaWarningMessage && (
+          <div className="px-6 pt-3">
+            <div className="rounded-xl border border-orange-200 bg-orange-50 px-4 py-2 text-sm text-orange-700">
+              {quotaWarningMessage}
+            </div>
+          </div>
+        )}
+
+        <div className="flex-1 overflow-y-auto px-6 py-6 space-y-4">
           {messages.length === 0 && !streamingText && (
             <div className="h-full flex items-center justify-center">
               <div className="text-center">
-                <h2 className="text-2xl font-semibold mb-2">Start a conversation</h2>
-                <p className="text-zinc-500">Type a message or drop an image</p>
+                <h2 className="text-2xl font-semibold mb-2">Начните диалог</h2>
+                <p className="text-zinc-500">Напишите сообщение или перетащите изображение</p>
               </div>
             </div>
           )}
-          
+
           {messages.map(message => (
-            <div key={message.id} className={`mb-4 ${message.role === 'user' ? 'flex justify-end' : ''}`}>
-              <div className={`max-w-3xl rounded-2xl px-4 py-3 ${
+            <div key={message.id} className={`flex gap-3 ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}>
+              {message.role === 'model' && (
+                <div className="h-9 w-9 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center flex-shrink-0">
+                  <Bot size={18} />
+                </div>
+              )}
+              <div className={`max-w-3xl rounded-2xl px-4 py-3 shadow-sm ${
                 message.role === 'user'
                   ? 'bg-blue-600 text-white'
-                  : theme === 'dark' ? 'bg-zinc-800' : 'bg-zinc-100'
+                  : theme === 'dark' ? 'bg-zinc-800 text-zinc-100' : 'bg-white text-zinc-900'
               }`}>
-                {/* Images */}
                 {message.images && message.images.length > 0 && (
-                  <div className="flex flex-wrap gap-2 mb-2">
+                  <div className="flex flex-wrap gap-2 mb-3">
                     {message.images.map((img, i) => (
-                      <img key={i} src={img} alt="" className="max-h-40 rounded-lg" />
+                      <img key={i} src={img} alt="" className="max-h-40 rounded-lg border border-zinc-200" />
                     ))}
                   </div>
                 )}
-                
-                {/* Content */}
+
                 {editingMessageId === message.id ? (
                   <div>
                     <textarea
                       value={editingContent}
                       onChange={(e) => setEditingContent(e.target.value)}
-                      className="w-full bg-zinc-700 rounded-lg p-2 text-white resize-none"
+                      className="w-full bg-zinc-100 rounded-lg p-2 text-zinc-900 resize-none"
                       rows={4}
                     />
                     <div className="flex gap-2 mt-2">
-                      <button onClick={handleSaveEdit} className="flex items-center gap-1 text-sm text-green-400 hover:text-green-300">
-                        <Check size={14} /> Save & Resend
+                      <button onClick={handleSaveEdit} className="flex items-center gap-1 text-sm text-green-600 hover:text-green-500">
+                        <Check size={14} /> Сохранить и отправить
                       </button>
-                      <button onClick={() => setEditingMessageId(null)} className="text-sm text-zinc-400 hover:text-white">
-                        Cancel
+                      <button onClick={() => setEditingMessageId(null)} className="text-sm text-zinc-400 hover:text-zinc-600">
+                        Отмена
                       </button>
                     </div>
                   </div>
                 ) : (
-                  <div 
-                    className="prose prose-invert max-w-none text-sm"
-                    dangerouslySetInnerHTML={{ __html: renderMarkdown(message.content) }}
-                  />
+                  <div className={`prose prose-sm max-w-none ${theme === 'dark' || message.role === 'user' ? 'prose-invert' : ''}`}>
+                    <ReactMarkdown rehypePlugins={[rehypeHighlight]}>
+                      {message.content}
+                    </ReactMarkdown>
+                  </div>
                 )}
-                
-                {/* Actions */}
-                {message.role === 'model' && !editingMessageId && (
-                  <div className="flex gap-2 mt-2 opacity-0 hover:opacity-100 transition">
-                    <button onClick={() => copyToClipboard(message.content)} className="text-xs text-zinc-400 hover:text-white flex items-center gap-1">
-                      <Copy size={12} /> Copy
+
+                {message.role === 'model' && (
+                  <div className="flex justify-end gap-3 mt-3 text-xs text-zinc-500">
+                    <button onClick={() => handleRetryMessage(message.id)} className="flex items-center gap-1 hover:text-blue-600">
+                      <RotateCcw size={14} /> Повторить
+                    </button>
+                    <button onClick={() => copyToClipboard(message.content)} className="flex items-center gap-1 hover:text-blue-600">
+                      <Copy size={14} /> Копировать
+                    </button>
+                    <button onClick={() => handleDeleteMessage(message.id)} className="flex items-center gap-1 hover:text-red-500">
+                      <Trash2 size={14} /> Удалить
                     </button>
                   </div>
                 )}
+
                 {message.role === 'user' && !editingMessageId && (
-                  <div className="flex gap-2 mt-2 opacity-0 hover:opacity-100 transition">
-                    <button onClick={() => startEdit(message)} className="text-xs text-blue-200 hover:text-white flex items-center gap-1">
-                      <Pencil size={12} /> Edit
+                  <div className="flex justify-end mt-2 text-xs text-blue-100">
+                    <button onClick={() => startEdit(message)} className="flex items-center gap-1 hover:text-white">
+                      <Pencil size={12} /> Редактировать
                     </button>
                   </div>
                 )}
               </div>
+              {message.role === 'user' && (
+                <div className="h-9 w-9 rounded-full bg-zinc-200 text-zinc-700 flex items-center justify-center flex-shrink-0">
+                  <User size={18} />
+                </div>
+              )}
             </div>
           ))}
-          
-          {/* Streaming */}
+
           {streamingText && (
-            <div className="mb-4">
-              <div className={`max-w-3xl rounded-2xl px-4 py-3 ${theme === 'dark' ? 'bg-zinc-800' : 'bg-zinc-100'}`}>
-                <div 
-                  className="prose prose-invert max-w-none text-sm"
-                  dangerouslySetInnerHTML={{ __html: renderMarkdown(streamingText) }}
-                />
+            <div className="flex gap-3">
+              <div className="h-9 w-9 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center flex-shrink-0">
+                <Bot size={18} />
+              </div>
+              <div className={`max-w-3xl rounded-2xl px-4 py-3 shadow-sm ${theme === 'dark' ? 'bg-zinc-800 text-zinc-100' : 'bg-white text-zinc-900'}`}>
+                <div className={`prose prose-sm max-w-none ${theme === 'dark' ? 'prose-invert' : ''}`}>
+                  <ReactMarkdown rehypePlugins={[rehypeHighlight]}>
+                    {streamingText}
+                  </ReactMarkdown>
+                </div>
               </div>
             </div>
           )}
-          
-          {/* Loading */}
+
           {isLoading && !streamingText && (
-            <div className="mb-4">
-              <div className={`inline-block rounded-2xl px-4 py-3 ${theme === 'dark' ? 'bg-zinc-800' : 'bg-zinc-100'}`}>
-                <div className="flex gap-1">
-                  <span className="w-2 h-2 bg-zinc-500 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
-                  <span className="w-2 h-2 bg-zinc-500 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
-                  <span className="w-2 h-2 bg-zinc-500 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
-                </div>
+            <div className="flex gap-3">
+              <div className="h-9 w-9 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center flex-shrink-0">
+                <Bot size={18} />
+              </div>
+              <div className={`inline-flex items-center gap-2 rounded-2xl px-4 py-3 ${theme === 'dark' ? 'bg-zinc-800' : 'bg-white'}`}>
+                <span className="w-2 h-2 bg-zinc-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
+                <span className="w-2 h-2 bg-zinc-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
+                <span className="w-2 h-2 bg-zinc-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
               </div>
             </div>
           )}
-          
+
           <div ref={messagesEndRef} />
         </div>
 
-        {/* Input area */}
-        <div className={`p-4 border-t ${theme === 'dark' ? 'border-zinc-700' : 'border-zinc-200'}`}>
-          {/* Image previews */}
+        <div className={`px-6 py-4 border-t ${theme === 'dark' ? 'border-zinc-800' : 'border-zinc-200'}`}>
           {images.length > 0 && (
-            <div className="flex flex-wrap gap-2 mb-2">
+            <div className="flex flex-wrap gap-2 mb-3">
               {images.map((img, i) => (
                 <div key={i} className="relative">
-                  <img src={img} alt="" className="h-16 rounded-lg" />
+                  <img src={img} alt="" className="h-16 rounded-lg border border-zinc-200" />
                   <button
                     onClick={() => setImages(prev => prev.filter((_, idx) => idx !== i))}
                     className="absolute -top-1 -right-1 bg-red-500 rounded-full p-0.5"
                   >
-                    <X size={12} />
+                    <X size={12} className="text-white" />
                   </button>
                 </div>
               ))}
             </div>
           )}
-          
-          <div className="flex items-end gap-2">
+
+          <div className="flex items-end gap-3">
             <input
               type="file"
               ref={fileInputRef}
@@ -803,11 +1002,11 @@ export default function App() {
             />
             <button
               onClick={() => fileInputRef.current?.click()}
-              className={`p-2.5 rounded-lg ${theme === 'dark' ? 'bg-zinc-700 hover:bg-zinc-600' : 'bg-zinc-100 hover:bg-zinc-200'}`}
+              className={`p-2.5 rounded-full border ${theme === 'dark' ? 'border-zinc-700 bg-zinc-800' : 'border-zinc-200 bg-white'} hover:border-blue-400`}
             >
               <Image size={20} />
             </button>
-            
+
             <textarea
               ref={textareaRef}
               value={input}
@@ -819,32 +1018,35 @@ export default function App() {
                   handleSend();
                 }
               }}
-              placeholder="Message..."
+              placeholder="Введите сообщение..."
               rows={1}
-              className={`flex-1 resize-none rounded-lg px-4 py-2.5 outline-none ${
-                theme === 'dark' 
-                  ? 'bg-zinc-700 focus:ring-2 focus:ring-blue-500' 
-                  : 'bg-zinc-100 focus:ring-2 focus:ring-blue-500'
+              className={`flex-1 resize-none rounded-2xl px-4 py-3 outline-none border ${
+                theme === 'dark'
+                  ? 'bg-zinc-800 border-zinc-700 focus:ring-2 focus:ring-blue-500'
+                  : 'bg-white border-zinc-200 focus:ring-2 focus:ring-blue-500'
               }`}
             />
-            
+
             {isLoading ? (
-              <button onClick={handleStop} className="p-2.5 bg-red-600 hover:bg-red-700 rounded-lg">
-                <Square size={20} />
+              <button onClick={handleStop} className="flex items-center gap-2 px-4 py-2 rounded-full bg-red-600 hover:bg-red-700 text-white">
+                <Square size={18} />
+                Остановить
               </button>
             ) : (
               <>
                 {messages.length >= 2 && (
-                  <button onClick={handleRegenerate} className={`p-2.5 rounded-lg ${theme === 'dark' ? 'bg-zinc-700 hover:bg-zinc-600' : 'bg-zinc-100 hover:bg-zinc-200'}`}>
-                    <RotateCcw size={20} />
+                  <button onClick={handleRegenerate} className={`flex items-center gap-2 px-4 py-2 rounded-full border ${theme === 'dark' ? 'border-zinc-700 bg-zinc-800' : 'border-zinc-200 bg-white'} hover:border-blue-400`}>
+                    <RotateCcw size={18} />
+                    Повторить
                   </button>
                 )}
                 <button
                   onClick={handleSend}
                   disabled={!input.trim() && images.length === 0}
-                  className="p-2.5 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 rounded-lg"
+                  className="flex items-center gap-2 px-4 py-2 rounded-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white"
                 >
-                  <Send size={20} />
+                  <Send size={18} />
+                  Отправить
                 </button>
               </>
             )}
@@ -852,46 +1054,108 @@ export default function App() {
         </div>
       </main>
 
-      {/* System Prompt Modal */}
+      <aside className={`w-80 border-l ${theme === 'dark' ? 'border-zinc-800 bg-zinc-900' : 'border-zinc-200 bg-zinc-50'} hidden xl:flex flex-col`}>
+        <div className={`p-6 border-b ${theme === 'dark' ? 'border-zinc-800' : 'border-zinc-200'}`}>
+          <div className="flex items-center justify-between mb-3">
+            <h3 className="text-sm font-semibold">Модели</h3>
+            <button onClick={() => loadModels(apiKey)} className={`p-1 rounded ${theme === 'dark' ? 'hover:bg-zinc-800' : 'hover:bg-zinc-200'}`}>
+              <RefreshCw size={14} className={loadingModels ? 'animate-spin' : ''} />
+            </button>
+          </div>
+          <div className="space-y-2 max-h-80 overflow-y-auto pr-1">
+            {models.length === 0 && (
+              <div className="text-xs text-zinc-500">Модели не загружены</div>
+            )}
+            {models.map(model => {
+              const badge = getQuotaBadge(model);
+              return (
+                <button
+                  key={model.value}
+                  onClick={() => setSelectedModel(model.value)}
+                  className={`w-full text-left px-3 py-2 rounded-xl border ${
+                    selectedModel === model.value
+                      ? theme === 'dark'
+                        ? 'border-blue-500 bg-zinc-800'
+                        : 'border-blue-500 bg-blue-50'
+                      : theme === 'dark'
+                        ? 'border-zinc-800 hover:border-blue-400'
+                        : 'border-zinc-200 hover:border-blue-300'
+                  }`}
+                >
+                  <div className="flex items-center justify-between gap-2">
+                    <div className="text-sm font-medium">{model.label}</div>
+                    <span className={`text-[10px] px-2 py-1 rounded-full ${badge.color}`}>{badge.text}</span>
+                  </div>
+                  <div className="text-xs text-zinc-500 mt-1">{model.description}</div>
+                  {model.inputTokens && (
+                    <div className="text-[11px] text-zinc-400 mt-1">
+                      {(model.inputTokens / 1000).toFixed(0)}K / {(model.outputTokens! / 1000).toFixed(0)}K токенов
+                    </div>
+                  )}
+                </button>
+              );
+            })}
+          </div>
+        </div>
+
+        <div className="p-6 space-y-3">
+          <button onClick={() => setShowSystemPrompt(true)} className={`w-full flex items-center justify-between px-4 py-2 rounded-xl border ${theme === 'dark' ? 'border-zinc-700 hover:border-blue-400' : 'border-zinc-200 hover:border-blue-300'}`}>
+            <span>Системный промпт</span>
+            <Settings size={16} />
+          </button>
+          <button onClick={handleExport} className={`w-full flex items-center justify-between px-4 py-2 rounded-xl border ${theme === 'dark' ? 'border-zinc-700 hover:border-blue-400' : 'border-zinc-200 hover:border-blue-300'}`}>
+            <span>Экспорт чата</span>
+            <Download size={16} />
+          </button>
+          <button onClick={toggleTheme} className={`w-full flex items-center justify-between px-4 py-2 rounded-xl border ${theme === 'dark' ? 'border-zinc-700 hover:border-blue-400' : 'border-zinc-200 hover:border-blue-300'}`}>
+            <span>Тема</span>
+            {theme === 'dark' ? <Sun size={16} /> : <Moon size={16} />}
+          </button>
+          <button onClick={() => setShowSettings(true)} className={`w-full flex items-center justify-between px-4 py-2 rounded-xl border ${theme === 'dark' ? 'border-red-500 text-red-300 hover:border-red-400' : 'border-red-200 text-red-600 hover:border-red-300'}`}>
+            <span>Выйти</span>
+            <ArrowRightLeft size={16} />
+          </button>
+        </div>
+      </aside>
+
       {showSystemPrompt && (
         <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
           <div className={`w-full max-w-lg rounded-2xl p-6 ${theme === 'dark' ? 'bg-zinc-800' : 'bg-white'}`}>
-            <h2 className="text-lg font-semibold mb-4">System Prompt</h2>
+            <h2 className="text-lg font-semibold mb-4">Системный промпт</h2>
             <textarea
               value={systemPrompt}
               onChange={(e) => setSystemPrompt(e.target.value)}
-              placeholder="Optional: Set AI behavior..."
+              placeholder="Опционально: настройте поведение модели..."
               rows={6}
-              className={`w-full rounded-lg p-3 resize-none ${theme === 'dark' ? 'bg-zinc-700' : 'bg-zinc-100'}`}
+              className={`w-full rounded-lg p-3 resize-none ${theme === 'dark' ? 'bg-zinc-700 text-white' : 'bg-zinc-100 text-zinc-900'}`}
             />
             <div className="flex justify-end gap-2 mt-4">
-              <button onClick={() => setShowSystemPrompt(false)} className="px-4 py-2 text-zinc-400 hover:text-white">
-                Cancel
+              <button onClick={() => setShowSystemPrompt(false)} className="px-4 py-2 text-zinc-400 hover:text-zinc-600">
+                Отмена
               </button>
-              <button onClick={handleSaveSystemPrompt} className="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg">
-                Save
+              <button onClick={handleSaveSystemPrompt} className="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white">
+                Сохранить
               </button>
             </div>
           </div>
         </div>
       )}
 
-      {/* Settings Modal (Logout) */}
       {showSettings && (
         <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
           <div className={`w-full max-w-sm rounded-2xl p-6 ${theme === 'dark' ? 'bg-zinc-800' : 'bg-white'}`}>
-            <h2 className="text-lg font-semibold mb-4">Settings</h2>
+            <h2 className="text-lg font-semibold mb-4">Настройки</h2>
             <button
               onClick={handleLogout}
               className="w-full px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white"
             >
-              Logout & Clear API Key
+              Выйти и очистить ключ API
             </button>
             <button
               onClick={() => setShowSettings(false)}
-              className="w-full px-4 py-2 mt-2 text-zinc-400 hover:text-white"
+              className="w-full px-4 py-2 mt-2 text-zinc-400 hover:text-zinc-600"
             >
-              Cancel
+              Отмена
             </button>
           </div>
         </div>
diff --git a/src/index.css b/src/index.css
index 8ee1fe2..df76aed 100644
--- a/src/index.css
+++ b/src/index.css
@@ -21,3 +21,7 @@
   transition-property: background-color, border-color;
   transition-duration: 150ms;
 }
+
+body {
+  font-family: "Google Sans", "Inter", "Helvetica Neue", "Arial", sans-serif;
+}
diff --git a/src/lib/db.ts b/src/lib/db.ts
index f2ed30a..e583eb2 100644
--- a/src/lib/db.ts
+++ b/src/lib/db.ts
@@ -37,7 +37,7 @@ export const db = new PolluxDatabase();
 export async function createChat(systemPrompt?: string): Promise<Chat> {
   const chat: Chat = {
     id: crypto.randomUUID(),
-    title: 'New Chat',
+    title: 'Новый чат',
     systemPrompt,
     createdAt: new Date(),
     updatedAt: new Date()
@@ -78,7 +78,7 @@ export async function addMessage(message: Omit<ChatMessage, 'id' | 'timestamp'>)
   const messageCount = await db.messages.where('chatId').equals(message.chatId).count();
   if (messageCount === 1 && message.role === 'user') {
     const title = message.content.slice(0, 50) + (message.content.length > 50 ? '...' : '');
-    await updateChat(message.chatId, { title: title || 'New Chat' });
+    await updateChat(message.chatId, { title: title || 'Новый чат' });
   } else {
     await updateChat(message.chatId, {});
   }
@@ -115,16 +115,16 @@ export async function exportChat(chatId: string): Promise<string> {
   if (!chat) return '';
   
   let markdown = `# ${chat.title}\n\n`;
-  markdown += `*Exported: ${new Date().toLocaleString()}*\n\n`;
+  markdown += `*Экспортировано: ${new Date().toLocaleString()}*\n\n`;
   
   if (chat.systemPrompt) {
-    markdown += `## System Prompt\n\n${chat.systemPrompt}\n\n`;
+    markdown += `## Системный промпт\n\n${chat.systemPrompt}\n\n`;
   }
   
   markdown += `---\n\n`;
   
   for (const msg of messages) {
-    const role = msg.role === 'user' ? '**You**' : '**Assistant**';
+    const role = msg.role === 'user' ? '**Вы**' : '**Ассистент**';
     markdown += `${role} (${new Date(msg.timestamp).toLocaleTimeString()})\n\n`;
     markdown += `${msg.content}\n\n`;
     if (msg.images?.length) {
-- 
2.43.0
